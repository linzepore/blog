<!DOCTYPE html><html lang="en" theme-mode="dark"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>23-03-05 | Linzepore's Blog</title><script>var config = {"root":"/","search":{"preload":false,"activeHolder":"Enter here","blurHolder":"Search","noResult":"Data \"$0\" not found"},"code":{"codeInfo":"$0 - $1 lines","copy":"copy","copyFinish":"copied","expand":"expand"}}</script><script src="//unpkg.com/mermaid@9.2.2/dist/mermaid.min.js"></script><link rel="stylesheet" href="/css/arknights.css"><script>if (window.localStorage.getItem('theme-mode') === 'light') document.documentElement.setAttribute('theme-mode', 'light')
if (window.localStorage.getItem('theme-mode') === 'dark') document.documentElement.setAttribute('theme-mode', 'dark')</script><style>@font-face {
 font-family: BenderLight;
 src: local('Bender'), url("/font/BenderLight.ttf");
}
@font-face {
 font-family: 'JetBrains Mono';
 src: local('JetBrains Mono'), url('/font/JetBrainsMono-Regular.woff2') format('woff2');
}</style><meta name="generator" content="Hexo 6.3.0"><link rel="alternate" href="/atom.xml" title="Linzepore's Blog" type="application/atom+xml">
</head><body><div class="loading" style="opacity: 0"><div class="loadingBar left"></div><div class="loadingBar right"></div></div><main><header class="closed"><nav><div class="navBtn hide"><i class="navBtnIcon"><span class="navBtnIconBar"></span><span class="navBtnIconBar"></span><span class="navBtnIconBar"></span></i></div><div class="navItem" id="search-header"><span class="navItemTitle"><input autocomplete="off" autocorrect="off" autocapitalize="none" placeholder="Search" spellcheck="false" maxlength="50" type="text" id="search-input"></span></div><div class="navItem" id="search-holder"></div><div class="search-popup"><div id="search-result"></div></div><ol class="navContent"><li class="navItem"><a class="navBlock" href="/"><span class="navItemTitle">Home</span></a></li><li class="navItem" matchdata="categories,tags"><a class="navBlock" href="/archives/"><span class="navItemTitle">Archives</span></a></li><li class="navItem"><a class="navBlock" href="/Donate/"><span class="navItemTitle">Donate</span></a></li></ol></nav></header><article><div id="post-bg"><div id="post-title"><h1>23-03-05</h1><div id="post-info"><span>First Post: <div class="control"><time datetime="2023-03-05T01:51:12.000Z" id="date"> 2023-03-05</time></div></span><br><span>Last Update: <div class="control"><time datetime="2023-03-05T14:15:50.474Z" id="updated"> 2023-03-05</time></div></span></div></div><hr><div id="post-content"><h1 id="2023-03-05"><a href="#2023-03-05" class="headerlink" title="2023-03-05"></a>2023-03-05</h1><h2 id="salt关键字"><a href="#salt关键字" class="headerlink" title="salt关键字"></a>salt关键字</h2><p>在 Solidity 中，salt 是一个关键字，它用于支持 create2 功能。自 0.8.0 版本起，可以通过指定 salt 选项来使用新的关键字</p>
<p>相关文章&#x2F;问答-&gt;<a target="_blank" rel="noopener" href="https://docs.soliditylang.org/en/develop/control-structures.html#salted-contract-creations-create2">Salted contract creations &#x2F; create2</a>、<a target="_blank" rel="noopener" href="https://ethereum.stackexchange.com/questions/125555/what-does-keyword-salt-mean-in-solidity">what does keyword “salt” mean in solidity?</a>、<a target="_blank" rel="noopener" href="https://ethereum.stackexchange.com/questions/101336/what-is-the-benefit-of-using-create2-to-create-a-smart-contract">What is the benefit of using create2() to create a smart contract?</a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">// SPDX-License-Identifier: GPL-3.0</span><br><span class="line">pragma solidity &gt;=0.7.0 &lt;0.9.0;</span><br><span class="line">contract D &#123;</span><br><span class="line">    uint public x;</span><br><span class="line">    constructor(uint a) &#123;</span><br><span class="line">        x = a;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">contract C &#123;</span><br><span class="line">    function createDSalted(bytes32 salt, uint arg) public &#123;</span><br><span class="line">        // This complicated expression just tells you how the address</span><br><span class="line">        // can be pre-computed. It is just there for illustration.</span><br><span class="line">        // You actually only need ``new D&#123;salt: salt&#125;(arg)``.</span><br><span class="line">        //这些复杂的表达只是告诉我们地址是如何被提前计算的，仅作展示</span><br><span class="line">        //事实上只需要``(new D)&#123;salt: salt&#125;(arg)``</span><br><span class="line">        address predictedAddress = address(uint160(uint(keccak256(abi.encodePacked(</span><br><span class="line">            bytes1(0xff),</span><br><span class="line">            address(this),</span><br><span class="line">            salt,</span><br><span class="line">            keccak256(abi.encodePacked(</span><br><span class="line">                type(D).creationCode,</span><br><span class="line">                abi.encode(arg)</span><br><span class="line">            ))</span><br><span class="line">        )))));</span><br><span class="line"></span><br><span class="line">        D d = new D&#123;salt: salt&#125;(arg);</span><br><span class="line">        require(address(d) == predictedAddress);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="例子"><a href="#例子" class="headerlink" title="例子"></a>例子</h3><p>在一个合约中创建合约其实有助于管理合约（不借助数据库）</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">pragma solidity ^0.8.17;</span><br><span class="line">//SPDX-License-Identifier: MIT</span><br><span class="line">contract Car&#123;</span><br><span class="line">    address owner;//表示拥有者</span><br><span class="line">    string public model;//表示车型</span><br><span class="line">    address carAddr;//表示合约地址</span><br><span class="line">    constructor(address _owner, string memory _model) payable&#123;</span><br><span class="line">        owner = _owner;</span><br><span class="line">        model = _model;</span><br><span class="line">        carAddr = address(this);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">contract CarFactory&#123;</span><br><span class="line">    Car[] public cars;</span><br><span class="line">    function createNewCar(string memory _model) public  &#123;</span><br><span class="line">        cars.push(new Car(address(this), _model));</span><br><span class="line">    &#125;</span><br><span class="line">    function createNewCarAndSendEther(string memory _model) public payable &#123;</span><br><span class="line">        Car car = (new Car)&#123;value:msg.value&#125;(address(this), _model);</span><br><span class="line">        cars.push(car);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    function create2NewCar(string memory _model, bytes32 salt) public &#123;</span><br><span class="line">        Car car = (new Car)&#123;salt:salt&#125;(address(this), _model);</span><br><span class="line">        cars.push(car);</span><br><span class="line">    &#125;</span><br><span class="line">    function create2NewCarWithEther(string memory _model, bytes32 salt) public payable &#123;</span><br><span class="line">        Car car = (new Car)&#123;value:msg.value, salt:salt&#125;(address(this), _model);</span><br><span class="line">        cars.push(car);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="部署及调试"><a href="#部署及调试" class="headerlink" title="部署及调试"></a>部署及调试</h3><p>推荐视频-&gt;<a target="_blank" rel="noopener" href="https://www.youtube.com/watch?v=CyzsUA12ju4">Learning Solidity (0.5) - Creating Contracts from a Contract</a></p>
<ul>
<li>部署车厂（CarFactory）合约</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/linzepore/blog_imgs@main/img/202303051151674.png"></p>
<ul>
<li>传入相关参数同时调用函数，找到cars索引复制其地址</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/linzepore/blog_imgs@main/img/202303051153548.png"></p>
<ul>
<li>通过地址寻找车合约</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/linzepore/blog_imgs@main/img/202303051155392.png"></p>
<h2 id="异常-try-catch"><a href="#异常-try-catch" class="headerlink" title="异常 try&#x2F;catch"></a>异常 try&#x2F;catch</h2><p>在函数体中使用try&#x2F;catch：</p>
<p><code>try</code> + <code>合约对象+函数名称(参数) +returns(接收返回值)</code> &#x2F; <code>try</code> + <code>合约对象(构造函数传参)</code></p>
<p><code>catch + Error(string memory result)</code>：处理require异常</p>
<p><code>catch + (bytes memory somereason)</code>：处理require异常</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">//SPDX-License-Identifier: MIT</span><br><span class="line">pragma solidity ^0.8.17;</span><br><span class="line">contract Foo &#123;</span><br><span class="line">address public owner;</span><br><span class="line">constructor(address _owner) &#123;</span><br><span class="line">require(_owner != address(0), &quot;invalid address&quot;);</span><br><span class="line">assert(_owner != 0x0000000000000000000000000000000000000001);</span><br><span class="line">owner = _owner;</span><br><span class="line">&#125;</span><br><span class="line">function myFunc(uint x) pure public returns(string memory)&#123;</span><br><span class="line">require(x!=0,&quot;x!=0&quot;);</span><br><span class="line">return &quot;my function is called! &quot;;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">contract Bar &#123;</span><br><span class="line">event log(string message);</span><br><span class="line">event logBtyes(bytes data);</span><br><span class="line">Foo foo;</span><br><span class="line">function tryCatchExternalCall(uint _i) public &#123;</span><br><span class="line">try foo.myFunc(_i) returns( string memory result) &#123;</span><br><span class="line">emit log(result);</span><br><span class="line">&#125; catch &#123;</span><br><span class="line">emit log(&quot;external call failed! &quot;);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">    function tryCatchNewContract(address addr) public  &#123;</span><br><span class="line">        try new Foo(addr) &#123;</span><br><span class="line">            emit log(&quot;create a new contract! &quot;);</span><br><span class="line">        &#125;catch Error(string memory reason) &#123;</span><br><span class="line">            emit log(reason);//捕获recert跟require异常</span><br><span class="line">        &#125;catch (bytes memory somereason) &#123;</span><br><span class="line">            emit logBtyes(somereason);//捕获assert异常</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="import"><a href="#import" class="headerlink" title="import"></a>import</h2><h3 id="例子-1"><a href="#例子-1" class="headerlink" title="例子"></a>例子</h3><p>文件路径</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">├── Import.sol</span><br><span class="line">└── Foo.sol</span><br></pre></td></tr></table></figure>

<p>Foo.sol</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">// SPDX-License-Identifier: MIT</span><br><span class="line">pragma solidity ^0.8.17;</span><br><span class="line"></span><br><span class="line">struct Point &#123;</span><br><span class="line">uint x;</span><br><span class="line">uint y;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">error Unauthorized(address caller);</span><br><span class="line"></span><br><span class="line">function add(uint x, uint y) pure returns (uint) &#123;</span><br><span class="line">return x + y;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">contract Foo &#123;</span><br><span class="line">string public name = &quot;Foo&quot;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Import.sol</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">// SPDX-License-Identifier: MIT</span><br><span class="line">pragma solidity ^0.8.17;</span><br><span class="line"></span><br><span class="line">// import Foo.sol from current directory</span><br><span class="line">import &quot;./Foo.sol&quot;;</span><br><span class="line"></span><br><span class="line">// import &#123;symbol1 as alias, symbol2&#125; from &quot;filename&quot;;</span><br><span class="line">import &#123;Unauthorized, add as func, Point&#125; from &quot;./Foo.sol&quot;;</span><br><span class="line"></span><br><span class="line">contract Import &#123;</span><br><span class="line">// Initialize Foo.sol</span><br><span class="line">Foo public foo = new Foo();</span><br><span class="line"></span><br><span class="line">    // Test Foo.sol by getting it&#x27;s name.</span><br><span class="line">    function getFooName() public view returns (string memory) &#123;</span><br><span class="line">        return foo.name();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>也可以通过其他地方导入</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">// https://github.com/owner/repo/blob/branch/path/to/Contract.sol</span><br><span class="line">import &quot;https://github.com/owner/repo/blob/branch/path/to/Contract.sol&quot;;</span><br><span class="line"></span><br><span class="line">// Example import ECDSA.sol from openzeppelin-contract repo, release-v4.5 branch</span><br><span class="line">// https://github.com/OpenZeppelin/openzeppelin-contracts/blob/release-v4.5/contracts/utils/cryptography/ECDSA.sol</span><br><span class="line">import &quot;https://github.com/OpenZeppelin/openzeppelin-contracts/blob/release-v4.5/contracts/utils/cryptography/ECDSA.sol&quot;;</span><br></pre></td></tr></table></figure>

<h3 id="注意事项"><a href="#注意事项" class="headerlink" title="注意事项"></a>注意事项</h3><p>没包在合约体内的函数不能有可见性<br><img src="https://cdn.jsdelivr.net/gh/linzepore/blog_imgs@main/img/202303052051289.png"></p>
<p>如果要调用另一个合约的状态变量，需要事先把该合约内的状态变量声明为public（会默认生成getter），然后在本合约访问时要使用<code>合约对象名.变量名()</code><br><img src="https://cdn.jsdelivr.net/gh/linzepore/blog_imgs@main/img/202303052101005.png"></p>
<h2 id="Library-库"><a href="#Library-库" class="headerlink" title="Library 库"></a>Library 库</h2><h3 id="一个可以去除元素同时减少空间的库"><a href="#一个可以去除元素同时减少空间的库" class="headerlink" title="一个可以去除元素同时减少空间的库"></a>一个可以去除元素同时减少空间的库</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">//SPDX-License-Identifier:MIT</span><br><span class="line">pragma solidity ^0.8.17;</span><br><span class="line">library Array &#123;</span><br><span class="line">function remove(uint[] storage arr, uint index) internal &#123;</span><br><span class="line">arr[index] = arr[arr.length-1];</span><br><span class="line">arr.pop();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="如何使用库"><a href="#如何使用库" class="headerlink" title="如何使用库"></a>如何使用库</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">//SPDX-License-Identifier:MIT</span><br><span class="line">pragma solidity ^0.8.17;</span><br><span class="line">import &quot;./LibImported.sol&quot;;</span><br><span class="line">contract testLib &#123;</span><br><span class="line">using Array for uint[];//要放在函数体外面</span><br><span class="line">uint[] arr;</span><br><span class="line">function testRm(uint _index) public returns(uint length1,uint length2) &#123;</span><br><span class="line">    for(uint i = 0; i &lt; 5; i++) &#123;</span><br><span class="line">        arr.push(i+1);</span><br><span class="line">    &#125;</span><br><span class="line">    //第一种调用库函数方法</span><br><span class="line">    arr.remove(_index);</span><br><span class="line">    length1 = arr.length;</span><br><span class="line">    //第二种调用方式</span><br><span class="line">    Array.remove(arr, _index);</span><br><span class="line">    length2 = arr.length;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="更多例子"><a href="#更多例子" class="headerlink" title="更多例子"></a>更多例子</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line">// SPDX-License-Identifier: MIT</span><br><span class="line">pragma solidity ^0.8.17;</span><br><span class="line"></span><br><span class="line">library Math &#123;</span><br><span class="line">    function sqrt(uint y) internal pure returns (uint z) &#123;</span><br><span class="line">        if (y &gt; 3) &#123;</span><br><span class="line">            z = y;</span><br><span class="line">            uint x = y / 2 + 1;</span><br><span class="line">            while (x &lt; z) &#123;</span><br><span class="line">                z = x;</span><br><span class="line">                x = (y / x + x) / 2;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; else if (y != 0) &#123;</span><br><span class="line">            z = 1;</span><br><span class="line">        &#125;</span><br><span class="line">        // else z = 0 (default value)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">contract TestMath &#123;</span><br><span class="line">    function testSquareRoot(uint x) public pure returns (uint) &#123;</span><br><span class="line">        return Math.sqrt(x);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// Array function to delete element at index and re-organize the array</span><br><span class="line">// so that there are no gaps between the elements.</span><br><span class="line">library Array &#123;</span><br><span class="line">    function remove(uint[] storage arr, uint index) public &#123;</span><br><span class="line">        // Move the last element into the place to delete</span><br><span class="line">        require(arr.length &gt; 0, &quot;Can&#x27;t remove from empty array&quot;);</span><br><span class="line">        arr[index] = arr[arr.length - 1];</span><br><span class="line">        arr.pop();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">contract TestArray &#123;</span><br><span class="line">    using Array for uint[];</span><br><span class="line"></span><br><span class="line">    uint[] public arr;</span><br><span class="line"></span><br><span class="line">    function testArrayRemove() public &#123;</span><br><span class="line">        for (uint i = 0; i &lt; 3; i++) &#123;</span><br><span class="line">            arr.push(i);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        arr.remove(1);</span><br><span class="line"></span><br><span class="line">        assert(arr.length == 2);</span><br><span class="line">        assert(arr[0] == 0);</span><br><span class="line">        assert(arr[1] == 2);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><img src="https://cdn.jsdelivr.net/gh/linzepore/blog_imgs@main/img/202303052210013.png"></p>
<p>相关视频-&gt;<a target="_blank" rel="noopener" href="https://www.youtube.com/watch?v=iIMSMfArTiE">HERE</a></p>
<h3 id="注意事项-1"><a href="#注意事项-1" class="headerlink" title="注意事项"></a>注意事项</h3><p><img src="https://cdn.jsdelivr.net/gh/linzepore/blog_imgs@main/img/202303052209053.png"></p>
<ul>
<li><p><code>using A for B</code>中A可以理解为库名称，B为第一个传入参数类型</p>
</li>
<li><p>如果库的函数可见性声明为internal需要嵌入本合约代码</p>
</li>
<li><p>某些函数非internal时候需要实现部署它，并将其与使用该合约函数连接起来（remix做不到、可节省gas开销）</p>
</li>
</ul>
<div id="paginator"></div></div><div id="post-footer"><div id="pages"><div class="footer-link" style="width: 50%;text-align:right;border-right:1px #fe2 solid"><a href="/2023/03/06/2023-03-06.html/">← Next 23-03-06</a></div><div class="footer-link" style="width: 50%;right:1px;border-left:1px #fe2 solid"><a href="/2023/03/04/2023-03-04.html/">23-03-04 Prev →</a></div></div></div></div><div class="bottom-btn"><div><a id="to-top" onClick="scrolls.scrolltop();" title="To Top" style="opacity: 0; display: none;">∧</a><a id="to-index" href="#toc-div" title="To Catalog">≡</a><a id="color-mode" onClick="colorMode.change()" title="Change Theme"></a></div></div></article><aside><div id="about"><a href="/" id="logo"><img src="https://ak.hypergryph.com/assets/index/images/ak/pc/faction/1.png" alt="Logo"></a><h1 id="Dr"><a href="/">Linzepore</a></h1><div id="description"><p></p></div></div><div id="aside-block"><div id="toc-div"><h1>Catalog</h1><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#2023-03-05"><span class="toc-number">1.</span> <span class="toc-text">2023-03-05</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#salt%E5%85%B3%E9%94%AE%E5%AD%97"><span class="toc-number">1.1.</span> <span class="toc-text">salt关键字</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BE%8B%E5%AD%90"><span class="toc-number">1.1.1.</span> <span class="toc-text">例子</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%83%A8%E7%BD%B2%E5%8F%8A%E8%B0%83%E8%AF%95"><span class="toc-number">1.1.2.</span> <span class="toc-text">部署及调试</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BC%82%E5%B8%B8-try-catch"><span class="toc-number">1.2.</span> <span class="toc-text">异常 try&#x2F;catch</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#import"><span class="toc-number">1.3.</span> <span class="toc-text">import</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BE%8B%E5%AD%90-1"><span class="toc-number">1.3.1.</span> <span class="toc-text">例子</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9"><span class="toc-number">1.3.2.</span> <span class="toc-text">注意事项</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Library-%E5%BA%93"><span class="toc-number">1.4.</span> <span class="toc-text">Library 库</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%80%E4%B8%AA%E5%8F%AF%E4%BB%A5%E5%8E%BB%E9%99%A4%E5%85%83%E7%B4%A0%E5%90%8C%E6%97%B6%E5%87%8F%E5%B0%91%E7%A9%BA%E9%97%B4%E7%9A%84%E5%BA%93"><span class="toc-number">1.4.1.</span> <span class="toc-text">一个可以去除元素同时减少空间的库</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A6%82%E4%BD%95%E4%BD%BF%E7%94%A8%E5%BA%93"><span class="toc-number">1.4.2.</span> <span class="toc-text">如何使用库</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9B%B4%E5%A4%9A%E4%BE%8B%E5%AD%90"><span class="toc-number">1.4.3.</span> <span class="toc-text">更多例子</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9-1"><span class="toc-number">1.4.4.</span> <span class="toc-text">注意事项</span></a></li></ol></li></ol></li></ol></div></div><footer><nobr><span class="text-title">ICP</span><a class="text-content" target="_blank" rel="noopener" href="https://beian.miit.gov.cn/">粤ICP备19120384号-2</a></nobr><nobr>Published with <a target="_blank" rel="noopener" href="http://hexo.io">Hexo</a></nobr><wbr><nobr> Theme <a target="_blank" rel="noopener" href="https://github.com/Yue-plus/hexo-theme-arknights">Arknights</a></nobr><wbr><nobr>by <a target="_blank" rel="noopener" href="https://github.com/Yue-plus">Yue_plus</a></nobr></footer></aside></main><canvas id="canvas-dust"></canvas><script src="/js/search.js"></script><script class="pjax-js">reset=_=>{code.findCode();}</script><script src="/js/arknights.js"></script><script src="/js/pjax.js"></script><script>window.addEventListener("load",() => {pjax = new Pjax({
 cacheBust: false,
 selectors: ['title','article','#aside-block','.pjax-js'],
 switches: {'article': Pjax.switches.sideBySide},
 switchesOptions: {
   'article': {
     classNames: {
       remove: "pjax-out",
       add: "pjax-in"
     }
   }
 }
});
document.addEventListener("pjax:complete", reset);reset()})</script></body></html>